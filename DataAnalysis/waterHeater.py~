import matplotlib.pyplot as plt
import matplotlib.patches as mpatches
from xbee import XBee
import serial
def getSensorReading(serialPort):
    """
    Read data from sensor.

    serial_port: A string with the port number where the xbee reciever is connected
    for windows system is something like 'COM3','COM4'.. etc
    for Linux/Unix systems should be something lik '/dev/ttyUSB0', '/dev/ttyUSB1' ...etc

    """
    ser = serial.Serial(serialPort,9600) # Serial port to which the reciever is connected
    xbee = XBee(ser)                         # Xbee object
    response = xbee.wait_read_frame() # get reading
    #response['timestamp'] = datetime.now()
    ser.close()
    return response
def updateGraph(temp,graph):
    """Updates the currenta and voltage values in the specified graph.
    graph: Intance of a matplotlib figure object (graph = plt.figure())

    """
    graph.plot(temp,'r')                                       # Plot the voltage values (red line)
    tLegend = mpatches.Patch(color='red',label='Temperature')  # Create volatage patch for plot legend
    graph.set_xlabel("Time")                                   # X axis label
    graph.set_ylabel("Temperature")                            # y axis label for the voltage data (This is displayed on the right of the graph)
    graph.legend([tLegend],["Temperature"])                    # Add the legend patches to the graph/figure
    graph.canvas.draw()                                        # Show the graph
    graph.cla()                                                # Clear the current data.

def menu():

    print"================"
    print"Commands for water heater:"
    print"1.- ON"
    print"2.- OFF"
    print"3.- Status"
    print"4.- Set temperature offset"
    print"5.- Show temperature graph"

def main():
    while True:
        try:
            reading = getSensorReading('/dev/ttyUSB0')
            print reading['rf_data']
        except KeyboardInterrupt:
            break
if __name__ == '__main__':
    main()
